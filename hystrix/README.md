# Hystrix 实现为服务的容错处理

## 理解容错机制

在高负载场景下，如果不对响应时间做处理，可能会导致服务消费端的资源耗竭甚至整个系统的崩溃。

#### 什么是雪崩效应
我们常把“基础服务故障”导致“级联故障”的现象称为雪崩效应，雪崩效应描述的是提供者不可用导致消费者不可用，并将不可用逐渐放大的过程。

#### 容错机制

要想防止雪崩效应，必须有一个强大的容错机制，该容错机制需实现以下两点：

   - 为网络请求设置超时
   - 使用断路器模式
        - 正常情况下，断路器关闭，可正常请求依赖的服务
        - 当一段时间内，请求失败率达到一定阈值(例如错误率达到 50%，或 100次/分钟 等)，断路器就会打开，此时不会再去请求依赖的服务
        - 断路器打开一段时间后，会自动进入“半开”状态，此时断路器可允许一个请求访问依赖的服务。如果该请求能够调用成功，则关闭断路器；否则继续保持打开状态
综上，我们可以通过以上两点机制保护应用，从而防止雪崩效应并提升应用的可用性

## Hystrix 简介
Hystrix 是 一个实现了超时机制和断路器模式的工具类库。

Hystrix 是 Netflix 开源的一个延迟和容错库，用于隔离访问远程系统、服务或者第三方库，防止级联失败，从而提升系统的可用性和容错性。Hystrix 主要通过以下几点实现延迟和容错。
 - 包裹请求：使用 HystrixCommand (或HystrixObservableCommand)包裹对依赖的调用逻辑，每个命令在独立线程中执行，这使用了设计模式中的“命令模式”
 - 跳闸机制：当某服务的错误率超过一定阈值时，Hystrix 可以自动或者手动跳闸，停止请求该服务一段时间
 - 资源隔离：Hystrix 为每个依赖都维护了一个小型的线程池（或者信号量）。如果该线程池已满，发生该依赖的请求就被立即拒绝，而不是排队等候，从而加速失败判定。
 - 监控：Hystrix 可以近乎实时地监控运行指标和配置的变化，例如成功、超时、失败和被拒绝的请求等
 - 回退机制：当请求失败、超时、被拒绝或当断路器打开时，执行回退逻辑。回退逻辑由开发人员自行提供，例如返回一个缺省值。
 - 自我修复：断路器打开一段时间后，会自动进入半开状态
        
